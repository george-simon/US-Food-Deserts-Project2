-- State Food Desert Stats (For Data Table) --
SELECT state AS State
	  ,SUM(pop2010) AS Total_2010_Pop
	  ,SUM(is_lila_pop) AS Food_Desert_Pop
	  ,SUM(not_lila_pop) AS Non_Food_Desert_Pop
	  ,ROUND(SUM(CAST(is_lila_pop AS FLOAT)) / SUM(CAST(pop2010 AS FLOAT))*100) AS Percent_Food_Desert
	  ,ROUND(SUM(CAST(not_lila_pop AS FLOAT)) / SUM(CAST(pop2010 AS FLOAT))*100) AS Percent_Non_Food_Desert
	  ,ROUND(SUM(CAST(is_lila_white AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_white AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS White_More_Less_Likely_FD
	  ,ROUND(SUM(CAST(is_lila_black AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_black AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS Black_More_Less_Likely_FD
	  ,ROUND(SUM(CAST(is_lila_aian AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_aian AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS Amer_Ind_AK_Native_More_Less_Likely_FD
	  ,ROUND(SUM(CAST(is_lila_asian AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_asian AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS Asian_More_Less_Likely_FD
	  ,ROUND(SUM(CAST(is_lila_nhopi AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_nhopi AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS Native_HI_Pac_Is_More_Less_Likely_FD
	  ,ROUND(SUM(CAST(is_lila_multir AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_multir AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS Multi_Race_More_Less_Likely_FD
	  ,ROUND(SUM(CAST(is_lila_hispanic AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_hispanic AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS Hispanic_More_Less_Likely_FD
	  ,ROUND(SUM(CAST(is_lila_white AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) AS White_Percent_Food_Desert
	  ,ROUND(SUM(CAST(is_lila_black AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) AS Black_Percent_Food_Desert
	  ,ROUND(SUM(CAST(is_lila_aian AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) AS Amer_Ind_AK_Native_Percent_Food_Desert
	  ,ROUND(SUM(CAST(is_lila_asian AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) AS Asian_Percent_Food_Desert
	  ,ROUND(SUM(CAST(is_lila_nhopi AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) AS Native_HI_Pac_Is_Percent_Food_Desert
	  ,ROUND(SUM(CAST(is_lila_multir AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) AS Multi_Race_Percent_Food_Desert
	  ,ROUND(SUM(CAST(is_lila_hispanic AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) AS Hispanic_Percent_Food_Desert
	  ,ROUND(SUM(CAST(not_lila_white AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS White_Percent_Not_Food_Desert
	  ,ROUND(SUM(CAST(not_lila_black AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS Black_Percent_Not_Food_Desert
	  ,ROUND(SUM(CAST(not_lila_aian AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS Amer_Ind_AK_Native_Percent_Not_Food_Desert
	  ,ROUND(SUM(CAST(not_lila_asian AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS Asian_Percent_Not_Food_Desert
	  ,ROUND(SUM(CAST(not_lila_nhopi AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS Native_HI_Pac_Is_Percent_Not_Food_Desert
	  ,ROUND(SUM(CAST(not_lila_multir AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS Multi_Race_Percent_Not_Food_Desert
	  ,ROUND(SUM(CAST(not_lila_hispanic AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS Hispanic_Percent_Not_Food_Desert
INTO nat_stat_table
FROM 
	(
	SELECT *
		  ,(is_lila_white + is_lila_black + is_lila_asian + is_lila_nhopi + is_lila_aian + is_lila_multir) AS is_lila_pop
		  ,(not_lila_white + not_lila_black + not_lila_asian + not_lila_nhopi + not_lila_aian + not_lila_multir) AS not_lila_pop
	FROM
		(
		SELECT state
			  ,pop2010
			  ,tractwhite
			  ,tractblack
			  ,tractasian
			  ,tractnhopi
			  ,tractaian
			  ,tractomultir
			  ,tracthispanic
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractwhite
				ELSE NULL
			   END is_lila_white
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractblack
				ELSE NULL
			   END is_lila_black
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractasian
				ELSE NULL
			   END is_lila_asian
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractnhopi
				ELSE NULL
			   END is_lila_nhopi
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractaian
				ELSE NULL
			   END is_lila_aian
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractomultir
				ELSE NULL
			   END is_lila_multir
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tracthispanic
				ELSE NULL
			   END is_lila_hispanic
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractsnap
				ELSE NULL
			   END is_lila_snap
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tractwhite
				ELSE NULL
			   END not_lila_white
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tractblack
				ELSE NULL
			   END not_lila_black
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tractasian
				ELSE NULL
			   END not_lila_asian
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tractnhopi
				ELSE NULL
			   END not_lila_nhopi
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tractaian
				ELSE NULL
			   END not_lila_aian
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tractomultir
				ELSE NULL
			   END not_lila_multir
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tracthispanic
				ELSE NULL
			   END not_lila_hispanic
		FROM data_food_deserts
		) b
	) a
GROUP BY state
ORDER BY ROUND(SUM(CAST(is_lila_pop AS FLOAT)) / SUM(CAST(pop2010 AS FLOAT))*100) DESC
;



-- National Food Desert Stats --
SELECT SUM(pop2010) AS total_pop_2010
	  ,SUM(is_lila_pop) AS is_lila_pop
	  ,SUM(not_lila_pop) AS not_lila_pop
	  ,ROUND(SUM(CAST(is_lila_pop AS FLOAT)) / SUM(CAST(pop2010 AS FLOAT))*100) AS is_lila_per
	  ,ROUND(SUM(CAST(not_lila_pop AS FLOAT)) / SUM(CAST(pop2010 AS FLOAT))*100) AS not_lila_per
	  ,ROUND(SUM(CAST(is_lila_white AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_white AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS lila_diff_white
	  ,ROUND(SUM(CAST(is_lila_black AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_black AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS lila_diff_black
	  ,ROUND(SUM(CAST(is_lila_asian AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_asian AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS lila_diff_asian
	  ,ROUND(SUM(CAST(is_lila_nhopi AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_nhopi AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS lila_diff_nhopi
	  ,ROUND(SUM(CAST(is_lila_aian AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_aian AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS lila_diff_aian
	  ,ROUND(SUM(CAST(is_lila_multir AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_multir AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS lila_diff_multir
	  ,ROUND(SUM(CAST(is_lila_hispanic AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_hispanic AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS lila_diff_hispanic
	  ,ROUND(SUM(CAST(is_lila_snap AS FLOAT)) / SUM(CAST(is_lila_pop AS FLOAT))*100) - ROUND(SUM(CAST(not_lila_snap AS FLOAT)) / SUM(CAST(not_lila_pop AS FLOAT))*100) AS lila_diff_snap
FROM 
	(
	SELECT *
		  ,(is_lila_white + is_lila_black + is_lila_asian + is_lila_nhopi + is_lila_aian + is_lila_multir) AS is_lila_pop
		  ,(not_lila_white + not_lila_black + not_lila_asian + not_lila_nhopi + not_lila_aian + not_lila_multir) AS not_lila_pop
	FROM
		(
		SELECT state
			  ,pop2010
			  ,tractwhite
			  ,tractblack
			  ,tractasian
			  ,tractnhopi
			  ,tractaian
			  ,tractomultir
			  ,tracthispanic
			  ,tractsnap
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractwhite
				ELSE NULL
			   END is_lila_white
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractblack
				ELSE NULL
			   END is_lila_black
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractasian
				ELSE NULL
			   END is_lila_asian
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractnhopi
				ELSE NULL
			   END is_lila_nhopi
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractaian
				ELSE NULL
			   END is_lila_aian
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractomultir
				ELSE NULL
			   END is_lila_multir
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tracthispanic
				ELSE NULL
			   END is_lila_hispanic
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN tractsnap
				ELSE NULL
			   END is_lila_snap
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tractwhite
				ELSE NULL
			   END not_lila_white
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tractblack
				ELSE NULL
			   END not_lila_black
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tractasian
				ELSE NULL
			   END not_lila_asian
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tractnhopi
				ELSE NULL
			   END not_lila_nhopi
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tractaian
				ELSE NULL
			   END not_lila_aian
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tractomultir
				ELSE NULL
			   END not_lila_multir
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tracthispanic
				ELSE NULL
			   END not_lila_hispanic
			  ,CASE
				WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN tractsnap
				ELSE NULL
			   END not_lila_snap
		FROM data_food_deserts
		) b
	) a
;




-- Additional Analysis Queries --
SELECT state
	  ,SUM(pop2010) AS Population
	  ,COUNT(CAST(lilatracts_1and10 AS INT)) AS count_tracts
	  ,SUM(CAST(lilatracts_1and10 AS INT)) AS count_lila_tracts
	  ,((SUM(CAST(lilatracts_1and10 AS FLOAT)) / COUNT(CAST(lilatracts_1and10 AS FLOAT)))* 100) AS perc_lila_tracts
FROM data_food_deserts
GROUP BY state
--ORDER BY ((SUM(CAST(lilatracts_1and10 AS FLOAT)) / COUNT(CAST(lilatracts_1and10 AS FLOAT)))* 100) DESC LIMIT 10
ORDER BY ((SUM(CAST(lilatracts_1and10 AS FLOAT)) / COUNT(CAST(lilatracts_1and10 AS FLOAT)))* 100) ASC LIMIT 10
;


SELECT state
	  ,ROUND(AVG(is_lilatract_1and10)) AS avg_medincome_lilatract
	  ,ROUND(AVG(not_lilatract_1and10)) AS avg_medincome_not_lilatract
	  ,100 - ((AVG(CAST(is_lilatract_1and10 AS FLOAT)) / AVG(CAST(NOT_lilatract_1and10 AS FLOAT))) * 100)
FROM
	(
	SELECT state
		  ,medianfamilyincome
		  ,CASE
			WHEN CAST(lilatracts_1and10 AS INT) = 1 THEN medianfamilyincome
			ELSE NULL
		   END is_lilatract_1and10
		  ,CASE
			WHEN CAST(lilatracts_1and10 AS INT) = 0 THEN medianfamilyincome
			ELSE NULL
		   END not_lilatract_1and10
	FROM data_food_deserts
	) a
GROUP BY state
--ORDER BY 100 - ((AVG(CAST(is_lilatract_1and10 AS FLOAT)) / AVG(CAST(NOT_lilatract_1and10 AS FLOAT))) * 100) DESC LIMIT 10
ORDER BY 100 - ((AVG(CAST(is_lilatract_1and10 AS FLOAT)) / AVG(CAST(NOT_lilatract_1and10 AS FLOAT))) * 100) ASC LIMIT 10
;